[
  {
    "submission_id": 1721337543,
    "code": "class Solution:\n    def maxSumTrionic(self, a: List[int]) -> int:\n        n = len(a)\n        pre = [0] * (n + 1)\n        inc = [1] * n\n        dec = [1] * n\n        inc2 = [1] * n\n        p = [0] * (n + 2)\n        lg = p[:]\n        m = len(p).bit_length()\n        mn = [[0] * (n + 1) for _ in range(m)]\n        mx = [[0] * (n + 1) for _ in range(m)]\n        inf = sys.maxsize\n        ninf = -inf\n\n        for i in range(n):\n            pre[i + 1] = pre[i] + a[i]\n        for i in range(1, n):\n            if a[i - 1] < a[i]:\n                inc[i] = inc[i - 1] + 1\n            if a[i - 1] > a[i]:\n                dec[i] = dec[i - 1] + 1\n        for i in range(n - 2, -1, -1):\n            if a[i] < a[i + 1]:\n                inc2[i] = inc2[i + 1] + 1\n        for i in range(2, n + 2):\n            p[i] = p[i >> 1] + 1\n        for i in range(n + 1):\n            mn[0][i] = mx[0][i] = pre[i]\n\n        j = 1\n        while (1 << j) <= n + 1:\n            h = 1 << (j - 1)\n            lim = (n + 1) - (1 << j) + 1\n            for i in range(lim):\n                mn[j][i] = min(mn[j - 1][i], mn[j - 1][i + h])\n                mx[j][i] = max(mx[j - 1][i], mx[j - 1][i + h])\n            j += 1\n\n        def qmn(l, r):\n            if l > r: return inf\n            k = p[r - l + 1]\n            return min(mn[k][l], mn[k][r - (1 << k) + 1])\n\n        def qmx(l, r):\n            if l > r: return ninf\n            k = p[r - l + 1]\n            return max(mx[k][l], mx[k][r - (1 << k) + 1])\n\n        res = ninf\n        for i in range(1, n - 1):\n            if dec[i] >= 2 and inc2[i] >= 2:\n                l = i - dec[i] + 1\n                lv = inf\n                for j in range(l, i):\n                    if inc[j] >= 2:\n                        lo = j - inc[j] + 1\n                        hi = j - 1\n                        lv = min(lv, qmn(lo, hi))\n                if lv == inf: continue\n                rv = qmx(i + 2, i + inc2[i])\n                if rv != ninf:\n                    res = max(res, rv - lv)\n        return res\n",
    "lang": "python3",
    "question_id": 3956,
    "contest_submission": 25560468
  },
  {
    "submission_id": 1721333751,
    "code": "class Solution:\n    def maxSumTrionic(self, nums: List[int]) -> int:\n        n = len(nums)\n        negInf = -10**30\n        pre = [0] * n\n        pre[0] = nums[0]\n        for i in range(1, n):\n            pre[i] = pre[i-1] + nums[i]\n        incEnd = [negInf] * n\n        hasInc = [False] * n\n        for i in range(1, n):\n            if nums[i-1] < nums[i]:\n                cur = nums[i-1] + nums[i]\n                if hasInc[i-1]:\n                    ext = incEnd[i-1] + nums[i]\n                    if ext > cur:\n                        cur = ext\n                incEnd[i] = cur\n                hasInc[i] = True\n        incStart = [negInf] * n\n        hasIncStart = [False] * n\n        for i in range(n-2, -1, -1):\n            if nums[i] < nums[i+1]:\n                cur = nums[i] + nums[i+1]\n                if hasIncStart[i+1]:\n                    ext = incStart[i+1] + nums[i]\n                    if ext > cur:\n                        cur = ext\n                incStart[i] = cur\n                hasIncStart[i] = True\n        ans = negInf\n        runStart = 0\n        def process(s, e):\n            nonlocal ans\n            if e - s + 1 < 2:\n                return\n            bestT = negInf\n            for q in range(s+1, e+1):\n                p = q - 1\n                if hasInc[p]:\n                    prevSum = pre[p-1] if p-1 >= 0 else 0\n                    t = incEnd[p] - nums[p] - prevSum\n                    if t > bestT:\n                        bestT = t\n                if hasIncStart[q] and bestT > negInf:\n                    cand = bestT + pre[q] + incStart[q] - nums[q]\n                    if cand > ans:\n                        ans = cand\n        for i in range(1, n+1):\n            if i < n and nums[i-1] > nums[i]:\n                continue\n            process(runStart, i-1)\n            runStart = i\n        return ans",
    "lang": "python3",
    "question_id": 3956,
    "contest_submission": 25557377
  },
  {
    "submission_id": 1721357504,
    "code": "class Solution:\n    def maxSumTrionic(self, nums: List[int]) -> int:\n        best1 = best2 = best3 = -inf\n        ans = -inf\n        for i in range(1, len(nums)):\n            a = nums[i-1]\n            b = nums[i]\n            if a == b:\n                best1 = best2 = best3 = -inf\n            elif a < b:\n                best3 = max(best2 + b, best3 + b)\n                best2 = -inf\n                best1 = max(best1, a + b, best1 + b)\n            else:\n                best3 = -inf\n                best2 = max(best2 + b, best1 + b)\n                best1 = -inf\n            # print(nums[:i+1], best1, best2, best3)\n            ans = max(best3, ans)\n        return ans",
    "lang": "python3",
    "question_id": 3956,
    "contest_submission": 25576762
  }
]