[
  {
    "submission_id": 1754202539,
    "code": "MOD=10**9+7\n\nclass Solution:\n    def totalBeauty(self, nums: List[int]) -> int:\n        def add(i,x):\n            while i<=n:\n                if bit[i]==0: touched.append(i)\n                bit[i]+=x\n                if bit[i]>=MOD: bit[i]-=MOD\n                i+=i&-i\n\n        def sumq(i):\n            s=0\n            while i>0:\n                s+=bit[i]\n                if s>=MOD: s-=MOD\n                i-=i&-i\n            return s\n\n        n=len(nums)\n        mx=max(nums)\n        pos=[[] for _ in range(mx+1)]\n        for i,v in enumerate(nums,1):\n            pos[v].append(i)\n        phi=list(range(mx+1))\n        for p in range(2,mx+1):\n            if phi[p]==p:\n                for k in range(p,mx+1,p):\n                    phi[k]=phi[k]//p*(p-1)\n        bit=[0]*(n+2)\n        touched=[]\n\n        res=0\n        for d in range(1,mx+1):\n            tot=0\n            for m in range(d,mx+1,d):\n                pl=pos[m]\n                if not pl: continue\n                tmp=[]\n                for idx in pl:\n                    s=sumq(idx-1)\n                    v=s+1\n                    if v>=MOD: v-=MOD\n                    tmp.append((idx,v))\n                    tot+=v\n                    if tot>=MOD: tot-=MOD\n                for idx,v in tmp:\n                    add(idx,v)\n            if tot:\n                res=(res+phi[d]*tot)%MOD\n            for p in touched: bit[p]=0\n            touched.clear()\n        return res%MOD",
    "lang": "python3",
    "question_id": 3989,
    "contest_submission": 26138876
  },
  {
    "submission_id": 1754240103,
    "code": "MOD=10**9+7\nclass Solution:\n    def totalBeauty(self, nums: List[int]) -> int:\n        if not nums:return 0\n        mx=max(nums);seq=[[] for _ in range(mx+1)]\n        for x in nums:\n            r=int(math.isqrt(x))\n            for d in range(1,r+1):\n                if x%d==0:\n                    seq[d].append(x)\n                    od=x//d\n                    if od!=d:seq[od].append(x)\n        f=[0]*(mx+1)\n        for g in range(1,mx+1):\n            if not seq[g]:continue\n            vals=sorted(set(seq[g]));mp={v:i+1 for i,v in enumerate(vals)}\n            bit=[0]*(len(vals)+1);tg=0\n            def add(i,v):\n                while i<len(bit):bit[i]=(bit[i]+v)%MOD;i+=i&-i\n            def sm(i):\n                s=0\n                while i>0:s=(s+bit[i])%MOD;i-=i&-i\n                return s\n            for v in seq[g]:\n                i=mp[v];cur=(sm(i-1)+1)%MOD\n                add(i,cur);tg=(tg+cur)%MOD\n            f[g]=tg\n        h=[0]*(mx+1)\n        for g in range(mx,0,-1):\n            val=f[g]\n            for k in range(2*g,mx+1,g):val=(val-h[k])%MOD\n            h[g]=val\n        ans=0\n        for g in range(1,mx+1):\n            if h[g]:ans=(ans+g*h[g])%MOD\n        return ans",
    "lang": "python3",
    "question_id": 3989,
    "contest_submission": 26165068
  },
  {
    "submission_id": 1754216231,
    "code": "from array import array\n\nMOD = 10**9 + 7\n\nN = 70000\n\nphi = list(range(N + 1))\nfor i in range(2, N + 1):\n    if phi[i] == i:\n        for j in range(i, N + 1, i):\n            phi[j] -= phi[j] // i\nspf = list(range(N + 1))\np = 2\nwhile p * p <= N:\n    if spf[p] == p:\n        step = p\n        start = p * p\n        for j in range(start, N + 1, step):\n            if spf[j] == j:\n                spf[j] = p\n    p += 1\n\n\n@cache\ndef divisors(x: int):\n    res = [1]\n    t = x\n    while t > 1:\n        p = spf[t]\n        e = 0\n        while t % p == 0:\n            t //= p\n            e += 1\n        cur = []\n        mul = 1\n        for _ in range(e):\n            mul *= p\n            for v in res:\n                cur.append(v * mul)\n        res += cur\n    return res\n\n\nclass BIT:\n    __slots__ = (\"n\", \"t\")\n\n    def __init__(self, n: int):\n        self.n = n\n        self.t = array(\"I\", [0]) * (n + 1)\n\n    def add(self, i: int, delta: int):\n        t = self.t\n        n = self.n\n        while i <= n:\n            v = t[i] + delta\n            if v >= MOD:\n                v -= MOD\n            t[i] = v\n            i += i & -i\n\n    def sum(self, i: int) -> int:\n        s = 0\n        t = self.t\n        while i > 0:\n            s += t[i]\n            if s >= MOD:\n                s -= MOD\n            i -= i & -i\n        return s\n\nclass Solution:\n    def totalBeauty(self, nums: List[int]) -> int:\n        M = max(nums)\n        bits = {}\n        res = 0\n\n        for x in nums:\n            for m in divisors(x):\n                q = x // m\n                b = bits.get(m)\n                if b is None:\n                    b = BIT(M // m)\n                    bits[m] = b\n                cnt = 1 + b.sum(q - 1)\n                if cnt >= MOD:\n                    cnt -= MOD\n                b.add(q, cnt)\n                res = (res + phi[m] * cnt) % MOD\n\n        return res",
    "lang": "python3",
    "question_id": 3989,
    "contest_submission": 26148303
  }
]